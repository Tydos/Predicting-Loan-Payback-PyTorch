# Docker Compose Image for deploying to EC2
services:
  mlflow:
    build:
      context: .
      dockerfile: mlflow-server/mlflow.dockerfile
    environment:
      MLFLOW_BACKEND_STORE_URI: ${MLFLOW_BACKEND_STORE_URI}
      ARTIFACT_ROOT: ${ARTIFACT_ROOT}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      AWS_DEFAULT_REGION: us-east-1
    volumes:
      - ./mlruns:/app/mlruns
    ports:
      - "5000:5000"
    command:  >
      mlflow server
      --backend-store-uri $MLFLOW_BACKEND_STORE_URI
      --default-artifact-root $ARTIFACT_ROOT
      --host 0.0.0.0
      --port 5000
      --serve-artifacts